<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Group Transactions</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #f9f9f9;
        }

       
    .navbar {
      background-color: #333;
      padding: 10px;
      color: white;
      text-align: center;
    }

    .navbar a,
    .dropdown-btn {
      padding: 10px 20px;
      color: white;
      text-decoration: none;
      display: inline-block;
      cursor: pointer;
    }

    .dropdown {
      display: inline-block;
      position: relative;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #444;
      min-width: 160px;
      box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
      z-index: 1;
    }

    .dropdown-content a {
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      color: white;
      background-color: #444;
    }

    .dropdown-content a:hover {
      background-color: #555;
    }

    .dropdown:hover .dropdown-content {
      display: block;
    }
        .container {
            padding: 20px;
        }

        .group {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            position: relative;
        }

        .group-name {
            font-weight: bold;
        }

        .members {
            margin-top: 10px;
            display: none;
        }

        .member {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        .dropdown {
            position: relative;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background-color: white;
            min-width: 100px;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .dropdown-content button {
            width: 100%;
            padding: 5px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .add-person {
            margin-top: 10px;
            font-size: 0.9em;
            color: blue;
            cursor: pointer;
        }

        .log {
            margin-top: 30px;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            max-height: 150px;
            overflow-y: auto;
        }

        .paid {
            color: green;
        }

        .balance {
            color: red;
        }

        .delete-group {
            position: absolute;
            top: 10px;
            right: 10px;
            background: red;
            color: white;
            padding: 5px 10px;
            border: none;
            cursor: pointer;
        }
    </style>
</head>

<body>
   
  <div class="navbar">
    <a href="index.html">Groups</a>
    <a href="groups.html">Groups</a>
    <a href="person.html">Persons</a>
  </div>

    <div class="container" id="home">
        <h2>Group Transactions</h2>
        <div id="groupTransactions"></div>
        <h3 id="logs">Transaction Logs</h3>
        <div class="log" id="transactionLog"></div>
    </div>

    <script>
        function renderGroupTransactions() {
            const container = document.getElementById('groupTransactions');
            const groups = JSON.parse(localStorage.getItem('groups')) || [];

            container.innerHTML = '';

            groups.forEach((group, groupIndex) => {
                const groupDiv = document.createElement('div');
                groupDiv.classList.add('group');

                const groupName = document.createElement('div');
                groupName.classList.add('group-name');
                groupName.textContent = group.name;
                groupDiv.appendChild(groupName);

                const membersDiv = document.createElement('div');
                membersDiv.classList.add('members');

                group.people.forEach((person, personIndex) => {
                    const memberDiv = document.createElement('div');
                    memberDiv.classList.add('member');

                    const total = person.ticketPrice * person.qty;
                    const balance = total - person.paid;
                    const status = balance <= 0
                        ? `<span class="paid">Paid</span>`
                        : `<span class="balance">Pending: ‚Ç±${balance}</span>`;

                    memberDiv.innerHTML = `
                        <div>
                            ${person.name} - ‚Ç±${person.ticketPrice} √ó ${person.qty}, Paid: ‚Ç±${person.paid} ‚Äî ${status}
                        </div>
                        <div class="actions">
                            <div class="dropdown">
                                <button>Ôºã</button>
                                <div class="dropdown-content">
                                    <button onclick="addPayment(${groupIndex}, ${personIndex})">Add Payment</button>
                                    <button onclick="addTicket(${groupIndex}, ${personIndex})">Add Ticket</button>
                                </div>
                            </div>
                            <button onclick="editPerson(${groupIndex}, ${personIndex})">‚úèÔ∏è</button>
                            <button onclick="deletePerson(${groupIndex}, ${personIndex})">üóëÔ∏è</button>
                        </div>
                    `;
                    membersDiv.appendChild(memberDiv);
                });

                const addPersonBtn = document.createElement('div');
                addPersonBtn.classList.add('add-person');
                addPersonBtn.textContent = '+ Add Person';
                addPersonBtn.onclick = () => addPerson(groupIndex);
                membersDiv.appendChild(addPersonBtn);

                const deleteGroupBtn = document.createElement('button');
                deleteGroupBtn.classList.add('delete-group');
                deleteGroupBtn.textContent = 'Delete Group';
                deleteGroupBtn.onclick = () => deleteGroup(groupIndex);
                groupDiv.appendChild(deleteGroupBtn);

                groupDiv.appendChild(membersDiv);

                groupName.onclick = () => {
                    membersDiv.style.display = membersDiv.style.display === 'block' ? 'none' : 'block';
                };

                container.appendChild(groupDiv);
            });
        }

        function saveGroups(groups) {
            localStorage.setItem('groups', JSON.stringify(groups));
            renderGroupTransactions();
        }

        function logAction(groupIdx, message) {
            const groups = JSON.parse(localStorage.getItem('groups')) || [];
            const group = groups[groupIdx];
            group.transactionLog = group.transactionLog || [];
            const now = new Date();
            const timestamp = now.toLocaleString();
            group.transactionLog.push(`${timestamp}: ${message}`);
            saveGroups(groups);
        }

        function addPayment(groupIdx, personIdx) {
            const groups = JSON.parse(localStorage.getItem('groups')) || [];
            const amount = parseFloat(prompt('Enter amount to add as payment:'));
            if (!isNaN(amount)) {
                groups[groupIdx].people[personIdx].paid += amount;
                logAction(groupIdx, `${groups[groupIdx].people[personIdx].name} added payment ‚Ç±${amount}`);
                saveGroups(groups);
            }
        }

        function addTicket(groupIdx, personIdx) {
            const groups = JSON.parse(localStorage.getItem('groups')) || [];
            const qty = parseInt(prompt('Enter additional ticket quantity:'), 10);
            if (!isNaN(qty)) {
                groups[groupIdx].people[personIdx].qty += qty;
                logAction(groupIdx, `${groups[groupIdx].people[personIdx].name} added ${qty} ticket(s)`);
                saveGroups(groups);
            }
        }

        function editPerson(groupIdx, personIdx) {
            const groups = JSON.parse(localStorage.getItem('groups')) || [];
            const name = prompt('Edit name:', groups[groupIdx].people[personIdx].name);
            const ticketPrice = parseFloat(prompt('Edit ticket price:', groups[groupIdx].people[personIdx].ticketPrice));
            const qty = parseInt(prompt('Edit quantity:', groups[groupIdx].people[personIdx].qty), 10);
            const paid = parseFloat(prompt('Edit amount paid:', groups[groupIdx].people[personIdx].paid));

            if (name && !isNaN(ticketPrice) && !isNaN(qty) && !isNaN(paid)) {
                groups[groupIdx].people[personIdx] = { name, ticketPrice, qty, paid };
                logAction(groupIdx, `${name}'s details were edited.`);
                saveGroups(groups);
            }
        }

        function deletePerson(groupIdx, personIdx) {
            const groups = JSON.parse(localStorage.getItem('groups')) || [];
            const personName = groups[groupIdx].people[personIdx].name;
            groups[groupIdx].people.splice(personIdx, 1);
            logAction(groupIdx, `${personName} was deleted`);
            saveGroups(groups);
        }

        function addPerson(groupIdx) {
            const groups = JSON.parse(localStorage.getItem('groups')) || [];
            const name = prompt('Enter name of person:');
            const ticketPrice = parseFloat(prompt('Enter ticket price:'));
            const qty = parseInt(prompt('Enter ticket quantity:'), 10);
            const paid = parseFloat(prompt('Enter amount paid:'));

            if (name && !isNaN(ticketPrice) && !isNaN(qty) && !isNaN(paid)) {
                groups[groupIdx].people.push({ name, ticketPrice, qty, paid });
                logAction(groupIdx, `${name} was added to the group`);
                saveGroups(groups);
            }
        }

        function deleteGroup(groupIdx) {
            const groups = JSON.parse(localStorage.getItem('groups')) || [];
            const groupName = groups[groupIdx].name;
            groups.splice(groupIdx, 1);
            logAction(groupIdx, `${groupName} was deleted`);
            saveGroups(groups);
        }

        document.addEventListener('DOMContentLoaded', renderGroupTransactions);
    </script>
</body>

</html>
